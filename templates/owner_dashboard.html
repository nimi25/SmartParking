<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Owner Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)),
                  url("{{ url_for('static', filename='images/bengaluru-map.jpg') }}") no-repeat center center fixed;
      background-size: cover;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
    }
    /* Main container styled like the login container */
    .container {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(15px);
      -webkit-backdrop-filter: blur(15px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 20px;
      padding: 50px;
      max-width: 900px;
      width: 100%;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      color: #fff;
      text-align: center;
    }
    .card-container {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-top: 20px;
    }
    /* Individual cards now use a dark frosted style */
    .card {
      flex: 1 1 calc(33.33% - 20px);
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(15px);
      -webkit-backdrop-filter: blur(15px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      color: #fff;
      text-align: left;
    }
    .card h3 {
      margin-top: 0;
    }
    .card p {
      margin: 8px 0;
    }
    .card-actions {
      margin-top: 10px;
      display: flex;
      gap: 10px;
      align-items: center;
    }
    .map-container {
      height: 200px;
      width: 100%;
    }
    /* Buttons styled consistently */
    a.btn, button.btn {
      display: inline-block;
      color: #fff;
      background: linear-gradient(45deg, #ff416c, #ff4b2b);
      padding: 8px 16px;
      border-radius: 10px;
      text-decoration: none;
      border: none;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Welcome, Owner!</h2>
    <a href="{{ url_for('parking.add_parking_spot') }}" class="btn">Add a Parking Spot</a>
    <h3>Your Parking Spots</h3>
    <div class="card-container">
      {% for spot in spots %}
        <div class="card">
          <h3>{{ spot.location }}</h3>
          <p><strong>Price:</strong> ₹{{ spot.price }}</p>
          <p><strong>Status:</strong> {{ "Available" if spot.availability else "Not Available" }}</p>
          <p><strong>Available Hours:</strong>
            {% if spot.available_from and spot.available_to %}
              {{ spot.available_from.strftime('%I:%M %p') }} to {{ spot.available_to.strftime('%I:%M %p') }}
            {% else %}
              N/A
            {% endif %}
          </p>
          <div class="map-container" id="map-{{ spot.id }}"></div>
          <p><strong>2-Wheeler Spaces:</strong> {{ spot.two_wheeler_spaces or 0 }}</p>
          <p><strong>4-Wheeler Spaces:</strong> {{ spot.four_wheeler_spaces or 0 }}</p>
          <p><strong>Description:</strong> {{ spot.description or "N/A" }}</p>
          <div class="card-actions">
            <a href="{{ url_for('parking.update_parking_spot', spot_id=spot.id) }}" class="btn">Edit</a>
            <form action="{{ url_for('parking.delete_parking_spot', spot_id=spot.id) }}" method="POST" onsubmit="return confirm('Are you sure you want to delete this spot?');">
              <button type="submit" class="btn">Delete</button>
            </form>
          </div>
        </div>
      {% else %}
        <p>No parking spots added yet.</p>
      {% endfor %}
    </div>
    <br><br>
    <button onclick="window.location.href='{{ url_for('auth.logout') }}'" class="btn">Logout</button>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      {% for spot in spots %}
        var map_{{ spot.id }} = L.map('map-{{ spot.id }}').setView([{{ spot.lat }}, {{ spot.lng }}], 15);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: '© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map_{{ spot.id }});
        L.marker([{{ spot.lat }}, {{ spot.lng }}]).addTo(map_{{ spot.id }});
      {% endfor %}
    });
  </script>
</body>
</html>
